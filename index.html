<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JumperSim</title>
    <link rel="stylesheet" href="./src/css/devconsole.css" />
    <link rel="stylesheet" href="./src/css/tooltip.css" />
    <link rel="stylesheet" href="./src/css/playback-controls.css" />
    <link rel="stylesheet" href="./src/css/loader.css" />
    <link rel="stylesheet" href="./src/css/menu.css" />
    <link rel="stylesheet" href="./src/css/minimized-windows.css" />
    <link rel="stylesheet" href="./src/css/notification.css" />
    <link rel="stylesheet" href="./src/css/planeloadui.css" />
    <link rel="stylesheet" href="./src/css/separation-game.css" />
  </head>
  <body>
    <div id="mapbox-offscreen" style="width:512px;height:512px;position:absolute;left:-9999px;"></div>
    <div id="menu">
      <div id="logocontainer"></div>
      <div id="menu-items">
        <span class="logo-text">Jumper Sim</span>

        <div class="menu-item dropdown">
          <span>File</span>
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="handleClick('New Scene')">
              <span>Save</span>
            </div>
            <div class="dropdown-item">
              <span>Load from File</span>
            </div>
            <div class="dropdown-item">
              <span>Auto-Save</span>
              <input
                type="checkbox"
                onclick="handleToggle(this, 'Auto-Save')"
              />
            </div>
          </div>
        </div>

        <div class="menu-item dropdown">
          <span>Edit</span>
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="handleClick('Undo')">
              <span>Undo</span>
            </div>
            <div class="dropdown-item" onclick="handleClick('Redo')">
              <span>Redo</span>
            </div>
          </div>
        </div>

        <div class="menu-item dropdown">
          <span>Formations</span>
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="handleClick('Undo')">
              <span>Save Formation</span>
            </div>
            <div class="dropdown-item submenu">
              <span>Import Formation ></span>
              <div class="dropdown-menu right">
                <div class="dropdown-item" onclick="handleFileSelect()">
                  <span>From .jump</span>
                </div>
                <!-- <div class="dropdown-item" onclick="handleFileSelect()">
                  <span>From SkydiveDesigner.app</span>
                </div> -->
              </div>
            </div>
          </div>
        </div>

        <div class="menu-item dropdown">
          <span>Weather</span>
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="handleClick('Undo')">
              <span>Undo</span>
            </div>
            <div class="dropdown-item" onclick="handleClick('Redo')">
              <span>Redo</span>
            </div>
          </div>
        </div>
        <div class="menu-item dropdown">
          <span>View</span>
          <div class="dropdown-menu">
            <div class="dropdown-item">
              <span>Enable Trajectory Lines</span>
              <input
                type="checkbox"
              />
            </div>
            <div class="dropdown-item" id="show-tooltip">
              <span>Show Tooltip</span>
              <input
                type="checkbox"
                checked
              />
            </div>
          </div>
        </div>

        <div class="menu-item dropdown" id="window-submenu">
          <span>Window</span>
          <div class="dropdown-menu">
            <button class="dropdown-item" id="recenter-windows">
              <span>Re-center Windows</span>
            </button>
            <button class="dropdown-item" id="minimize-windows">
              <span>Minimize Windows</span>
            </button>
            <button class="dropdown-item" id="restore-windows">
              <span>Restore Windows</span>
            </button>
            <hr>
            <div class="dropdown-item" id="show-weatherdata">
              <span>Weather</span>
              <input type="checkbox" name="show-weatherdata" checked/>
            </div>
            <div class="dropdown-item" id="show-location">
              <span>Location</span>
              <input type="checkbox" name="show-location" checked/>
            </div>
            <div class="dropdown-item" id="show-playback">
              <span>Playback Controls</span>
              <input type="checkbox" name="show-playback" checked/>
            </div>
            <!-- <div class="dropdown-item" id="show-formation">
              <span>Formation Settings</span>
              <input type="checkbox" name="show-formation" checked/>
            </div> -->
            <div class="dropdown-item" id="show-plane">
              <span>Plane Settings</span>
              <input type="checkbox" name="show-plane" checked/>
            </div>
            <div class="dropdown-item" id="show-objects">
              <span>Scene Objects</span>
              <input type="checkbox" name="show-objects" checked/>
            </div>
            <div class="dropdown-item" id="show-sim">
              <span>Jump Settings</span>
              <input type="checkbox" name="show-sim" checked/>
            </div>
            <!-- <div class="dropdown-item" id="show-jumprun">
              <span>Jump-Run Settings</span>
              <input type="checkbox" name="show-jumprun" checked/>
            </div> -->
            <div class="dropdown-item" id="show-speed">
              <span>Speed Settings</span>
              <input type="checkbox" name="show-speed" checked/>
            </div>
            <div class="dropdown-item" id="show-following">
              <span>Following</span>
              <input type="checkbox" name="show-following" checked/>
            </div>
          </div>
        </div>
        <div class="menu-item dropdown">
          <span>Help</span>
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="handleClick('Undo')">
              <span>Information</span>
            </div>
          </div>
        </div>
        <div class="menu-item dropdown">
          <span>Minigames</span>
          <div class="dropdown-menu">
            <div class="dropdown-item" id="launch-separation-game">
              <span>Separation Timing Challenge</span>
            </div>
          </div>
        </div>
        <div class="menu-item dropdown">
          <span>Contributors</span>
          <div class="dropdown-menu" style="gap: 10px">
            <span>Sevan Evans B-63914</span>
            <span>Cole Patterson</span>
            <span>Alex Olsen</span>
          </div>
        </div>

        <div class="mainselection">
          <select class="weather-select-menu" id="dropzone-select">
            <option value="">-- Select a dropzone --</option>
        </select>
        </div>
        <!-- <div class="weather-select-menu">
          <select id="dropzone-select">
          <option value="">-- Select a dropzone --</option>
        </select> -->
        
        </div>
      </div>
    </div>

    <div id="minimized-bar"></div>

    <!-- compass -->
    <div id="compassContainer" style="position: absolute; margin: 3rem">
      <img src="./src/svg/compass.svg" alt="Compass" id="compass" />

    </div>

    <div class="panel" id="location-panel">
      <div class="panel-header">
        <h2>Location</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        <!-- <label for="dropzone-select">Choose a dropzone:</label> -->
        <div class="panel-controls">
          <div id="fetch-container">
            <div id="dropzone-details">

            </div>
            <!-- <button id="fetchWeather">Fetch Weather</button> -->
            <label>Model: Open-Mateo.com</label>
            <div
              id="fetchWeather-loader"
              class="dot-carousel"
              style="display: none"
            ></div>
          </div>
        </div>
        
      </div>
    </div>

    <div class="panel" id="jump-settings-panel">
      <div class="panel-header">
        <h2>Jump Settings</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
          Jump Name:
          <input
            type="text"
            id="jumpname"
            placeholder="Enter jump name"
            value="Untitled JumpSim"
          />
        </label>
        
        
        <label>
          Jump Height:
          <input
            type="number"
            id="pullAltitude"
            min="3000"
            max="18500"
            step="100"
            value="12500"
          />
        </label>
        <div class="panel-controls">
          <button id="start-align-jumprun">Align Jumprun</button>
        </div>
      </div>
    </div>

    <!-- deprecate this in favor of new jump-settings-panel -->
    <!-- <div class="panel" id="sim-panel">
      <div class="panel-header">
        <h2>Jump Settings</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        <label>
          Separation (s):
          <input
            type="number"
            id="separation"
            min="0"
            max="10"
            step="0.1"
            value="2"
          />
        </label>
        <label>
          Pull Altitude (ft):
          <input
            type="number"
            id="pullAltitude"
            min="500"
            max="6000"
            step="100"
            value="3500"
          />
        </label>
      </div>
    </div> -->

    <div class="panel" id="weatherdata-panel">
      <div class="panel-header">
        <h2>Weather</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        
      </div>
    </div>

    <div class="panel" id="objects-panel">
      <div class="panel-header">
        <h2>Scene Objects</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        <label
          >TODO: add current active jumpers and planes where you can view stats
          and look at objects</label
        >
      </div>
    </div>

    <div class="panel" id="following-panel">
      <div class="panel-header">
        <h2>Following</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        <label id="following-label"
          >You're not following anything.
          <span id="hidden-message"></span> Check out the Scene Objects tab!</span>
        </label>
        <label id="following-id"></label>
        <div class="panel-controls">
          <button>Stop following</button>
        </div>
      </div>
    </div>

    <div class="panel" id="speed-panel">
      <div class="panel-header">
        <h2>Speed Settings</h2>
        <div class="panel-controls">
          <button>-</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        <label>
          Plane Speed (knots):
          <input
            type="number"
            id="planeSpeed"
            min="50"
            max="150"
            step="1"
            value="90"
          />
        </label>
        <label>
          Belly Jumper Speed (ft/s):
          <input
            type="number"
            id="bellySpeed"
            min="90"
            max="150"
            step="1"
            value="130"
          />
        </label>
        <label>
          Freefly Jumper Speed (ft/s):
          <input
            type="number"
            id="freeflySpeed"
            min="100"
            max="200"
            step="1"
            value="160"
          />
        </label>
      </div>
    </div>

    <div class="tooltip" id="info-tooltip"></div>

    <div class="panel" id="playback-panel">
      <div class="panel-header">
        <h2>Playback Controls</h2>
        <div class="panel-controls">
          <button>‚Äì</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body">
        <div class="panel-controls" id="playback-controls">
          <button id="start">‚èÆ</button>
          <button id="rewind">‚è¥</button>
          <button id="playPause">‚ñ∂</button>
          <button id="forward">‚èµ</button>
          <button id="end">‚è≠</button>
        </div>

        <input
          type="range"
          id="scrubber"
          min="0"
          max="250"
          value="0"
          step="0.1"
          style="flex: 1"
        />
        <span
          id="timeLabel"
          style="min-width: 60px; text-align: right; color: #fff"
          >0.0s</span
        >
      </div>
    </div>

    <div class="panel" id="plane-panel">
        <div class="panel-header">
            <h2>Plane Settings</h2>
            <div class="panel-controls">
                <button>-</button>
                <button>√ó</button>
            </div>
        </div>
        <div class="panel-body">
            <div class="mainselection">
                <select class="weather-select-menu" id="plane-select">
                    <option value="">-- Select a plane --</option>
                    <option value="cessna-172">Cessna-172</option>
                    <option value="skyvan">Skyvan</option>
                    <option value="dc-9">DC-9</option>
                    <option value="twin-otter">Twin Otter</option>
                </select>
            </div>
            <div id="plane-status">No plane selected</div>

            <div class="panel-controls">
              <button id="edit-plane-load" onclick="startPlaneEdit()">Edit Plane Load</button>
            </div>
            <div class="plane-load-editor">
              <!-- Dynamic content will be rendered here by PlaneSettings.js -->
            </div>
            <div id="plane-summary">
              <h3>Plane Summary</h3>
              <p>Load Size: <span id="load-size">0</span></p>
              <p>Speed: <span id="plane-speed">0</span> knots</p>
              <p>Direction: <span id="plane-direction">N/A</span></p>
            </div>
        </div>
    </div>

    <!-- <div class="panel" id="formation-panel">
      <div class="panel-header">
        <h2>Formation Settings</h2>
        <div class="panel-controls">
          <button>-</button>
          <button>√ó</button>
        </div>
      </div>
      <div class="panel-body"></div>
    </div> -->

    <script src="./src/js/GlobalVars.ts" type="module" defer></script>
    <script src="./src/js/DevConsole.ts" type="module"></script>
    <script src="./src/js/TimeScrubber.ts" type="module"></script>
    <script src="./src/js/Scripts.ts" type="module" defer></script>
    <script src="./src/apidata/OpenMateo.ts" type="module"></script>
    <script src="./src/js/LocationSelect.ts" type="module"></script>
    <script src="./src/js/Menubar.ts" type="module"></script>
    <script src="./src/js/ui/PlaneSettings.ts" type="module"></script>

    <!-- Separation Timing Minigame -->
    <div id="separation-game-container">
      <div class="separation-game-overlay">
        <!-- Header -->
        <div class="game-header">
          <div class="game-title">Separation Timing Challenge</div>
          <div class="bonus-indicator" id="bonus-indicator" style="display:none;">üéâ BONUS ROUND! üéâ</div>
          <div class="round-display">Round <span id="current-round">1</span></div>
          <div class="score-display">
            <div class="score-item">
              <div class="score-label">Wins</div>
              <div class="score-value" id="wins-count">0</div>
            </div>
            <div class="score-item">
              <div class="score-label">Losses</div>
              <div class="score-value fail" id="losses-count">0</div>
            </div>
            <div class="score-item">
              <div class="score-label">Streak</div>
              <div class="score-value" id="streak-count">0</div>
            </div>
          </div>
        </div>

        <!-- Main Game Area -->
        <div class="game-main">
          <!-- Left Panel -->
          <div class="game-left-panel">
            <!-- Separation Table -->
            <div class="game-info-card">
              <h3>Separation Table</h3>
              <table class="separation-table">
                <thead>
                  <tr>
                    <th>Ground Speed (kts)</th>
                    <th>Separation (sec)</th>
                  </tr>
                </thead>
                <tbody id="separation-table-body">
                  <tr><td>100</td><td>6</td></tr>
                  <tr><td>95</td><td>7</td></tr>
                  <tr><td>90</td><td>7</td></tr>
                  <tr><td>85</td><td>7</td></tr>
                  <tr><td>80</td><td>8</td></tr>
                  <tr><td>75</td><td>8</td></tr>
                  <tr><td>70</td><td>9</td></tr>
                  <tr><td>65</td><td>10</td></tr>
                  <tr><td>60</td><td>10</td></tr>
                  <tr><td>55</td><td>11</td></tr>
                  <tr><td>50</td><td>12</td></tr>
                  <tr><td>45</td><td>14</td></tr>
                  <tr><td>40</td><td>15</td></tr>
                  <tr><td>35</td><td>17</td></tr>
                  <tr><td>30</td><td>20</td></tr>
                  <tr><td>25</td><td>24</td></tr>
                  <tr><td>20</td><td>30</td></tr>
                  <tr><td>15</td><td>40</td></tr>
                  <tr><td>10</td><td>60</td></tr>
                  <tr><td>5</td><td>119</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Current Challenge -->
            <div class="game-info-card">
              <h3>Current Challenge</h3>
              <div class="challenge-info">
                <div class="challenge-row">
                  <span class="challenge-label">Airspeed:</span>
                  <span class="challenge-value" id="current-airspeed">-- kts</span>
                </div>
                <div class="challenge-row">
                  <span class="challenge-label">Headwind:</span>
                  <span class="challenge-value" id="current-headwind">-- kts</span>
                </div>
                <div class="challenge-row">
                  <span class="challenge-label">Ground Speed (Airspeed - Headwind):</span>
                  <span class="challenge-value" id="current-speed">-- kts</span>
                </div>
                <div class="challenge-row">
                  <span class="challenge-label">Required Separation:</span>
                  <span class="challenge-value" id="required-separation">-- sec</span>
                </div>
              </div>
            </div>

            <!-- Timer -->
            <div class="game-info-card">
              <div class="timer-display">
                <div class="timer-label">Time Since First Jumper</div>
                <div class="timer-value" id="game-timer">0.00</div>
              </div>
            </div>

            <!-- Instructions -->
            <div class="game-info-card game-instructions">
              <strong>üìã How to Play:</strong><br>
              <strong style="color: #4CAF50;">1.</strong> Use Airspeed ‚àí Headwind to get Ground Speed<br>
              <strong style="color: #4CAF50;">2.</strong> Find the required wait time in the table<br>
              <strong style="color: #4CAF50;">3.</strong> Watch the first jumper (red) exit the plane<br>
              <strong style="color: #4CAF50;">4.</strong> Press the button when the timer reaches that time<br>
              <strong style="color: #4CAF50;">5.</strong> Win by being within 2 seconds of the correct separation!<br>
              <br>
              <strong style="color: #f44336;">‚ö†Ô∏è Warning:</strong> Jumping too early = collision risk = automatic loss!
              <br>
              <strong style="color: #4CAF50;">Tip:</strong> Space/Enter triggers the main button.
            </div>
          </div>

          <!-- Right Panel - 3D View -->
          <div class="game-view-container" id="game-3d-view">
            <div class="game-view-overlay">
              <div class="view-status" id="game-view-status">Waiting to start...</div>
            </div>

            <div class="corner-button">
              <button class="jump-button" id="jump-now-button" disabled>
                JUMP!
              </button>
            </div>
            
            <!-- Results Overlay -->
            <div class="results-overlay" id="results-overlay">
              <div class="results-content">
                <div class="results-title" id="results-title">SUCCESS!</div>
                <div class="results-details" id="results-details">
                  Your separation: <span class="highlight" id="player-separation">5.2 sec</span>
                  Required: <span class="highlight" id="required-separation-result">6.0 sec</span>
                  Difference: <span class="highlight" id="separation-diff">0.8 sec</span>
                </div>
                <div class="results-actions">
                  <button class="results-button primary" id="next-round-button">Next Round</button>
                  <button class="results-button secondary" id="view-replay-button">View Separation</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
